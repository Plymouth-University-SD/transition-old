<%

# hacked in bar-chart ..
require 'date'
chart_height = 100
bar_width = 20

# classified totals for each week
weeks = {}

@total_data.totals.each do |total|

  week = total.total_on.strftime("%Y-%U")

  if total.http_status =~ /^2/
    name = "ok"
  elsif total.http_status == "301"
    name = "redirect"
  elsif total.http_status == "410"
    name = "gone"
  else
    name = "error"
  end

  weeks[week] ||= {}
  weeks[week][name] ||= 0
  weeks[week][name] += total.count
end

max_count = 0
weeks.each do |week, no|
  total = 0
  weeks[week].each do |status, count|
    total += count
  end
  max_count = total if total > max_count
end

dates = []
Date.parse('2012-10-17').step(Date.today, 7) do |day|
  dates.push(day.strftime("%Y-%U"))
end

left = 0;

%>

<section>
<div class="chart stacked" style="height:<%= chart_height %>px">

<% dates.each do |week| %>
<ul style="left:<%= left %>px">
<%  ["error", "gone", "redirect","ok"].reverse.each do |name|
      count = 0
      count = weeks[week][name] if weeks[week] && weeks[week][name]
      height = (count * chart_height) / max_count
      %>
  <li class="<%= name %>" style="height:<%= height %>px" title="<%= week %> <%= name %> <%= count %>"><%= count %></li>
<% end %>
</ul>
<%
left += bar_width
end %>
</div>
</section>