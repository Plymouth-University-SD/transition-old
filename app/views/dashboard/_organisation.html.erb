<%
@sites_count = organisation.sites.length

@hosts_count = 0
organisation.sites.each do |site|
  @hosts_count += site.hosts.count
end

@mappings_count = 0

%>

<h3 id="<%= organisation.abbr %>">
  <%= link_to content_tag(:span, organisation.abbr), organisation %>
</h3>

<div class="launched">
  <span class="date"><%= human_datetime(organisation.launch_date) %></span>
</div>

<div class="summary">
  <span class="number"><%= @sites_count %></span> <%= plural(@sites_count, "site") %>
  <span class="number"><%= @hosts_count %></span> <%= plural(@hosts_count, "host") %></span>
</div>

<div class="mappings">
  <span class="number"><%= @mappings_count %></span> <%= plural(@mappings_count, "mapping") %></span>
</div>

<table class="aggregate" border="0" cellpadding="0" cellspacing="0">
  <tbody>
<%
max = 200000
['ok','redirect','gone','error'].each do |name|
count = rand(max)
percentage = 100 * count / max;
%>
    <tr>
      <td class="name">
        <div class="cont">
          <div style="width: <%= percentage %>%;" class="<%= name %>"></div>
          <span><%= name %></span>
        </div>
      </td>
      <td class="num"><%= number_with_delimiter(count, :delimiter => ',') %></td>
    </tr>
<% end %>
  </tbody>
</table>